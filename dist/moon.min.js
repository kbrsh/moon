/*
* Moon v0.8.0
* Copyright 2016-2017, Kabir Shah
* https://github.com/KingPixil/moon/
* Free to use under the MIT license.
* https://kingpixil.github.io/license
*/
!function(e,t){"object"==typeof module&&module.exports?module.exports=t():e.Moon=t()}(this,function(){"use strict";function e(e){this.instance=e,this.cache={},this.signals={},this.dep={target:null,map:{}}}function t(t){this.$opts=t||{},this.$id=s++,this.$name=this.$opts.name||"root",this.$data=this.$opts.data||{},this.$render=this.$opts.render||$,this.$hooks=this.$opts.hooks||{},this.$methods=this.$opts.methods||{},this.$events={},this.$dom={},this.$observer=new e(this),this.$destroyed=!1,this.$initialRender=!0,this.$queued=!1,this.$opts.computed&&a(this,this.$opts.computed),this.init()}var r={},n={},i={},o={stop:"event.stopPropagation();",prevent:"event.preventDefault();",ctrl:"if(!event.ctrlKey) {return;};",shift:"if(!event.shiftKey) {return;};",alt:"if(!event.altKey) {return;};",enter:"if(event.keyCode !== 13) {return;};"},s=0,a=function(e,t){for(var r in t)!function(r){e.$observer.observe(r);var n={get:function(){var n=null;return e.$observer.cache[r]?n=e.$observer.cache[r]:(e.$observer.dep.target=r,n=t[r].get.call(e),e.$observer.dep.target=null,e.$observer.cache[r]=n),n}};t[r].set&&(n.set=function(n){return t[r].set.call(e,n)}),Object.defineProperty(e.$data,r,n)}(r)};e.prototype.observe=function(e){var t=this;this.signals[e]=function(){t.cache[e]=null}},e.prototype.notify=function(e){if(this.dep.map[e])for(var t=0;t<this.dep.map[e].length;t++)this.notify(this.dep.map[e][t]);this.signals[e]&&this.signals[e]()};var u=function(e){t.config.silent||console.log(e)},c=function(e){t.config.silent||console.error("[Moon] ERR: "+e)},l=function(e){e.$queued||e.$destroyed||(e.$queued=!0,setTimeout(function(){e.build(),y(e,"updated"),e.$queued=!1},0))},p=function(){return{shouldRender:!0,eventListeners:{}}},f=function(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n")},h=function(e,t,r,n){var i=null;r.replace(/\[(\w+)\]/g,function(e,t){r=r.replace(e,"."+t)});var o=r.split(".");for(i=0;i<o.length-1;i++){t=t[o[i]]}return t[o[i]]=n,o[0]},v=function(e,t){var r=e;return e.replace(/{{([A-Za-z0-9_$@]+)([A-Za-z0-9_.()'"+\-*\/\s\[\]]+)?}}/gi,function(e,n,i){i||(i=""),r=t?r.replace(e,'" + instance.get("'+n+'")'+i+' + "'):r.replace(e,'instance.get("'+n+'")'+i)}),r},d=function(e){var t={};if(!e)return t;t.default=[];for(var r=0;r<e.length;r++){var n=e[r],i=n.props.attrs;i.slot?(t[i.slot]?t[i.slot].push(n):t[i.slot]=[n],delete i.slot):t.default.push(n)}return t},m=function(e,t){for(var r in t)e[r]=t[r];return e},g=function(e,t){var r={};for(var n in e)r[n]=e[n];for(var n in t)r[n]=t[n];return r},y=function(e,t){var r=e.$hooks[t];r&&r.call(e)},$=function(){},b=function(e){for(var t={},r=e.attributes,n=r.length;n--;)t[r[n].name]=r[n].value;return t},x=function(e,t,r,n,i){return{type:e,val:t,props:r,children:n,meta:i||p()}},k=function(e,t,r){var n=r.opts.data||{};if(r.opts.props)for(var i=0;i<r.opts.props.length;i++){var o=r.opts.props[i];n[o]=e.attrs[o]}return r.opts.render(_,{data:n,slots:d(t)})},_=function(e,t,r,n){var o=[];if(n)for(var s=0;s<n.length;s++){var a=n[s];Array.isArray(a)?o=o.concat(a):"string"==typeof a||null===a?o.push(x("#text",a||"",{attrs:{}},[],p())):o.push(a)}if(i[e]){if(i[e].opts.functional)return k(t,o,i[e]);r.component=i[e]}return x(e,"",t,o,r)},A=function(e,t,r){var n=t.meta.eventListeners;for(var i in n)for(var o=0;o<n[i].length;o++){var s=n[i][o];e.addEventListener(i,s)}},C=function(e,t){var r=null;if("#text"===e.type)r=document.createTextNode(e.val);else{if(r=e.meta.isSVG?document.createElementNS("http://www.w3.org/2000/svg",e.type):document.createElement(e.type),1===e.children.length&&"#text"===e.children[0].type)r.textContent=e.children[0].val,e.children[0].meta.el=r.firstChild;else for(var n=0;n<e.children.length;n++){var i=e.children[n],o=C(e.children[n],t);r.appendChild(o),i.meta.component&&G(o,i,i.meta.component)}A(r,e)}return R(r,{},e,e.props.attrs),e.meta.el=r,e.meta.component&&G(r,e,e.meta.component),r},G=function(e,t,r){for(var n=new r.CTor,i=0;i<n.$props.length;i++){var o=n.$props[i];n.$data[o]=t.props.attrs[o]}return n.$slots=d(t.children),n.$el=e,n.build(),y(n,"mounted"),t.meta.el=n.$el,n.$el},w=function(e,t){e.__moon__&&e.__moon__.destroy(),t.removeChild(e)},L=function(e,t,r){e.__moon__&&e.__moon__.destroy(),r.replaceChild(t,e)},R=function(e,t,n,i){var o=e instanceof SVGElement;if(i)for(var s in i){var a=i[s],u=t[s];null!=u&&a===u||(o?e.setAttributeNS(null,s,a):e.setAttribute(s,a))}if(t)for(var c in t){var a=i[c],u=t[c];(null==a||r[c])&&(r[c]&&r[c](e,a,n),o?e.removeAttributeNS(null,c):e.removeAttribute(c))}if(n.props.dom)for(var l in n.props.dom){var p=n.props.dom[l];e[l]!==p&&(e[l]=p)}},S=function(e,t){if(e.__moon__){for(var r=e.__moon__,n=!1,i=0;i<r.$props.length;i++){var o=r.$props[i];r.$data[o]!==t.props.attrs[o]&&(r.$data[o]=t.props.attrs[o],n=!0)}t.children&&(r.$slots=d(t.children),n=!0),n&&r.build()}else G(e,t,t.meta.component)},O=function(e,t,r,n){var i=e?e.nodeName.toLowerCase():null;if(e){if(t){if(i!==t.type){var o=C(t,n);return L(e,o,r),o}if(t.meta.shouldRender&&"#text"===t.type)return e&&"#text"===i?(e.nodeValue!==t.val&&(e.nodeValue=t.val),t.meta.el=e):L(e,C(t,n),r),e;if(t.meta.shouldRender){if(t.meta.el=e,t.meta.component)return S(e,t),e;if(R(e,b(e),t,t.props.attrs),A(e,t),t.props.dom&&t.props.dom.innerHTML)return e;for(var s=0,a=e.firstChild,u=t.children[s];u||a;)O(a,u,e,n),u=t.children[++s],a=a?a.nextSibling:null;return e}return t.meta.el=e,e}return w(e,r),null}var o=C(t,n);return r.appendChild(o),o},T=function(e,t,r,n){if(e===t)return t.meta.el;if(e){if(t){if(e.type!==t.type){var i=C(t,n);return L(e.meta.el,i,r),i}if(t.meta.shouldRender&&"#text"===t.type){var o=e.meta.el;return"#text"===e.type?(t.val!==e.val&&(o.textContent=t.val),t.meta.el=o):L(o,C(t,n),r),t.meta.el}if(t.meta.shouldRender){var s=e.meta.el;if(t.meta.el=s,t.meta.component)return S(s,t),s;if(R(s,e.props.attrs,t,t.props.attrs),t.props.dom&&t.props.dom.innerHTML)return s;var a=t.children.length,u=e.children.length,c=null,l=null;if(1===a&&"#text"===(c=t.children[0]).type&&1===u&&"#text"===(l=e.children[0]).type)c.val!==l.val&&(s.textContent=c.val,c.meta.el=s.firstChild);else if(0===a){if(0!==u)for(var p=null;p=s.firstChild;)w(p,s)}else for(var f=a>u?a:u,h=0;h<f;h++)T(e.children[h],t.children[h],s,n);return s}return t.meta.el=e.meta.el,t.meta.el}return w(e.meta.el,r),null}var i=C(t,n);return r.appendChild(i),i},E=function(e){var t={input:e,current:0,tokens:[]};return j(t),t.tokens},j=function(e){for(var t=e.input,r=t.length;e.current<r;)"<"===t.charAt(e.current)?"<!--"!==t.substr(e.current,4)?N(e):M(e):D(e)},D=function(e){var t=e.input,r=t.length,n=t.indexOf("<",e.current);if(n===-1)return e.tokens.push({type:"text",value:t.slice(e.current)}),void(e.current=r);n!==e.current&&(e.tokens.push({type:"text",value:t.slice(e.current,n)}),e.current=n)},M=function(e){var t=e.input,r=t.length;e.current+=4;var n=t.indexOf("-->",e.current);if(n===-1)return e.tokens.push({type:"comment",value:t.slice(e.current)}),void(e.current=r);e.tokens.push({type:"comment",value:t.slice(e.current,n)}),e.current=n+3},N=function(e){var t=e.input,r=(t.length,"/"===t.charAt(e.current+1));e.tokens.push({type:"tagStart",close:r}),e.current+=r?2:1;var n=V(e);P(e);var i="/"===t.charAt(e.current);e.tokens.push({type:"tagEnd",close:!1}),e.current+=i?2:1,i&&(e.tokens.push({type:"tagStart",close:!0}),e.tokens.push({type:"tag",value:n}),e.tokens.push({type:"attribute",value:{}}),e.tokens.push({type:"tagEnd",close:!1}))},V=function(e){for(var t=e.input,r=t.length,n=e.current;n<r;){var i=t.charAt(n);if("/"!==i&&">"!==i&&" "!==i)break;n++}for(var o=n;o<r;){var i=t.charAt(o);if("/"===i||">"===i||" "===i)break;o++}var s=t.slice(n,o);return e.tokens.push({type:"tag",value:s}),e.current=o,s},P=function(e){for(var t=e.input,r=t.length,n=e.current,i={},o=t.charAt(n),s=t.charAt(n+1),a=function(){n++,o=t.charAt(n),s=t.charAt(n+1)};n<r&&">"!==o&&("/"!==o||">"!==s);)if(" "!==o){for(var u="",c=!1;"="!==o&&n<r;){if(!(" "!==o&&">"!==o||"/"===o&&">"!==s)){c=!0;break}u+=o,a()}var l={name:u,value:"",meta:{}};if(c)i[u]=l;else{var p=" ";for(a(),"'"===o||'"'===o?(p=o,a()):l.value+=o;(o!==p&&">"!==o||"/"===o&&">"!==s)&&n<r;)l.value+=o,a();if(u.indexOf(":")!==-1){var f=u.split(":");l.name=f[0],l.meta.arg=f[1]}i[u]=l,a()}}else a();e.current=n,e.tokens.push({type:"attribute",value:i})},q=function(e){for(var t={type:"ROOT",children:[]},r={current:0,tokens:e};r.current<e.length;){var n=Z(r);n&&t.children.push(n)}return t},H=["area","base","br","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],K=["svg","animate","circle","clippath","cursor","defs","desc","ellipse","filter","font-face","foreignObject","g","glyph","image","line","marker","mask","missing-glyph","path","pattern","polygon","polyline","rect","switch","symbol","text","textpath","tspan","use","view"],z=function(e,t,r){return{type:e,props:t,children:r}},Z=function(e){var t=e.tokens[e.current],r=e.tokens[e.current-1],n=e.tokens[e.current+1],i=e.tokens[e.current+2],o=e.tokens[e.current+3],s=function(o){e.current+=void 0===o?1:o,t=e.tokens[e.current],r=e.tokens[e.current-1],n=e.tokens[e.current+1],i=e.tokens[e.current+2]};if("text"===t.type)return s(),r.value;if("comment"===t.type)return void s();if("tagStart"===t.type&&!t.close&&!o.close){var a=z(n.value,i.value,[]);n.value;if(s(4),K.indexOf(a.type)!==-1&&(a.isSVG=!0),H.indexOf(a.type)!==-1)return a;e.current;if(t){for(;"tagStart"!==t.type||"tagStart"===t.type&&!t.close;){var u=Z(e);if(u&&a.children.push(u),s(0),!t)break}s()}return a}s()},F=function(e){var t=e.props.attrs,i="{attrs: {";if(t){for(var o in t){var s=t[o].name;if(r[s]&&(e.dynamic=!0),n[s])n[s].afterGenerate&&(e.specialDirectivesAfter||(e.specialDirectivesAfter={}),e.specialDirectivesAfter[o]=t[o]),n[s].beforeGenerate&&n[s].beforeGenerate(t[o].value,t[o].meta,e),n[s].duringPropGenerate&&(i+=n[s].duringPropGenerate(t[o].value,t[o].meta,e)),e.dynamic=!0,delete t[o];else{var a=JSON.stringify(t[o].value),u=v(a,!0);a!==u&&(e.dynamic=!0),i+='"'+o+'": '+u+", "}}Object.keys(t).length?i=i.slice(0,-2)+"}":i+="}"}var c=e.props.dom;if(c){e.dynamic=!0,i+=", dom: {";for(var l in c)i+='"'+l+'": '+c[l]+", ";i=i.slice(0,-2)+"}"}return i+="}"},J=function(e){if(0===Object.keys(e).length)return"{}";var t="{";for(var r in e)t+='"'+r+'": ['+I(e[r])+"], ";return t=t.slice(0,-2)+"}"},B=function(e){var t="{";for(var r in e)t+="eventListeners"===r?'"'+r+'": '+J(e[r])+", ":'"'+r+'": '+e[r]+", ";return t=t.slice(0,-2)+"}"},I=function(e){for(var t="",r=0;r<e.length;r++)t+=e[r]+", ";return t=t.slice(0,-2)},Q=function(e){var t='h("'+e.type+'", ';t+=F(e)+", ";var r=e.children.map(U);return 1!==e.children.length||1!==r.length||"string"!=typeof e.children[0]||'"'+e.children[0]+'"'!==r[0]||e.dynamic||(e.meta.shouldRender="instance.$initialRender"),t+=B(e.meta),t+=r.length?", ["+I(r)+"]":"",t+=")"},U=function(e){var t="";if("string"==typeof e)t+='"'+v(f(e),!0)+'"';else{e.meta||(e.meta=p(),e.isSVG&&(e.meta.isSVG=!0)),e.props={attrs:e.props};var r=e.props.attrs.name,i="slot"===e.type?"instance.$slots['"+(r&&r.value||"default")+"']":Q(e);if(e.specialDirectivesAfter)for(var o in e.specialDirectivesAfter)i=n[e.specialDirectivesAfter[o].name].afterGenerate(e.specialDirectivesAfter[o].value,e.specialDirectivesAfter[o].meta,i,e);t+=i}return t},W=function(e){var t=e.children[0],r="var instance = this; return "+U(t);try{return new Function("h",r)}catch(e){return c("Could not create render function"),$}},X=function(e){var t=E(e),r=q(t);return W(r)};return t.prototype.get=function(e){return this.$observer.dep.target&&(this.$observer.dep.map[e]||(this.$observer.dep.map[e]=[]),this.$observer.dep.map[e].push(this.$observer.dep.target)),this.$data[e]},t.prototype.set=function(e,t){var r=h(0,this.$data,e,t);this.$observer.notify(r),l(this)},t.prototype.destroy=function(){this.removeEvents(),this.$el=null,this.$destroyed=!0,y(this,"destroyed")},t.prototype.callMethod=function(e,t){t=t||[],this.$methods[e].apply(this,t)},t.prototype.on=function(e,t){this.$events[e]?this.$events[e].push(t):this.$events[e]=[t]},t.prototype.off=function(e,t){var r=this.$events[e].indexOf(t);r!==-1&&this.$events[e].splice(r,1)},t.prototype.removeEvents=function(){for(var e in this.$events)this.$events[e]=[]},t.prototype.emit=function(e,t){if(t=t||{},t.type=e,this.$events["*"])for(var r=0;r<this.$events["*"].length;r++)this.$events["*"][r](t);for(var n=0;n<this.$events[e].length;n++)this.$events[e][n](t)},t.prototype.renderLoop=function(e,t){for(var r=new Array(e.length),n=0;n<e.length;n++)r[n]=t(e[n],n);return r},t.prototype.renderClass=function(e){if("string"==typeof e)return e;var t="";if(Array.isArray(e))for(var r=0;r<e.length;r++)t+=this.renderClass(e[r])+" ";else if("object"==typeof e)for(var n in e)e[n]&&(t+=n+" ");return t=t.slice(0,-1)},t.prototype.mount=function(e){this.$el=document.querySelector(e),this.$destroyed=!1,this.$el.__moon__=this,this.$template=this.$opts.template||this.$el.outerHTML,this.$render===$&&(this.$render=t.compile(this.$template)),this.build(),y(this,"mounted")},t.prototype.render=function(){return this.$render(_)},t.prototype.patch=function(e,t,r){var n=null,i=null;e.meta&&e.meta.el?(i=e.meta.el,n=T(e,t,r,this)):e instanceof Node&&(i=e,n=O(e,t,r,this)),i!==n&&(this.$el=n,this.$el.__moon__=this),this.$initialRender=!1},t.prototype.build=function(){var e=this.render();this.patch(this.$dom.meta?this.$dom:this.$el,e,this.$el.parentNode),this.$dom=e},t.prototype.init=function(){u("======= Moon ======="),y(this,"init"),this.$opts.el&&this.mount(this.$opts.el)},t.config={silent:!0,prefix:"m-",keyCodes:function(e){for(var t in e)o[t]="if(event.keyCode !== "+e[t]+") {return;};"}},t.version="0.8.0",t.util={noop:$,error:c,log:u,merge:g,extend:m,h:_},t.use=function(e){e.init(t)},t.compile=function(e){return X(e)},t.nextTick=function(e){setTimeout(e,0)},t.directive=function(e,n){r[t.config.prefix+e]=n},t.component=function(e,r){function n(){t.call(this,r)}var o=this;return r.name?e=r.name:r.name=e,n.prototype=Object.create(o.prototype),n.prototype.constructor=n,n.prototype.init=function(){y(this,"init"),this.$destroyed=!1,this.$props=this.$opts.props||[],this.$template=this.$opts.template,this.$render===$&&(this.$render=t.compile(this.$template))},i[e]={CTor:n,opts:r},n},n[t.config.prefix+"if"]={afterGenerate:function(e,t,r,n){return"("+v(e,!1)+") ? "+r+" : ''"}},n[t.config.prefix+"show"]={duringPropGenerate:function(e,t,r){return'"m-show": '+v(e,!1)+", "}},n[t.config.prefix+"for"]={afterGenerate:function(e,t,r,n){var i=e.split(" in "),o=i[0].split(","),s=v(i[1],!1),a=o.join(",");return r.replace(/instance\.get\("([^"]+)"\)/g,function(e,t){o.indexOf(t)!==-1&&(r=r.replace(new RegExp('instance.get\\("'+t+'"\\)',"g"),t))}),"instance.renderLoop("+s+", function("+a+") { return "+r+"; })"}},n[t.config.prefix+"on"]={beforeGenerate:function(e,t,r){var n=t.arg.split("."),i=n[0],s="event",a=v(e,!1),u=a.split("(");u.length>1&&(a=u.shift(),s=u.join("(").slice(0,-1));var c="";n.shift();for(var l=0;l<n.length;l++)c+=o[n[l]];var p="function(event) {"+c+'instance.callMethod("'+a+'", ['+s+"])}";r.meta.eventListeners[i]?r.meta.eventListeners[i].push(p):r.meta.eventListeners[i]=[p]}},n[t.config.prefix+"model"]={beforeGenerate:function(e,t,r){var n=v(e,!0),i="input",o="value";r.props.attrs.type&&"checkbox"===r.props.attrs.type.value&&(i="change",o="checked");var s='function(event) {instance.set("'+n+'", event.target.'+o+")}";r.meta.eventListeners[i]?r.meta.eventListeners[i].push(s):r.meta.eventListeners[i]=[s];var a=v("{{"+v(e,!1)+"}}",!1);r.props.dom||(r.props.dom={}),r.props.dom[o]=a}},n[t.config.prefix+"literal"]={duringPropGenerate:function(e,t,r){var n=t.arg;return r.props.attrs[n]={value:!0,meta:{}},"class"===n?'"class": instance.renderClass('+v(e,!1)+"), ":'"'+n+'": '+v(e,!1)+", "}},n[t.config.prefix+"once"]={beforeGenerate:function(e,t,r){r.meta.shouldRender="instance.$initialRender"}},n[t.config.prefix+"pre"]={beforeGenerate:function(e,t,r){r.meta.shouldRender=!1}},n[t.config.prefix+"html"]={beforeGenerate:function(e,t,r){r.props.dom||(r.props.dom={}),r.props.dom.innerHTML='"'+v(e,!0)+'"'}},n[t.config.prefix+"text"]={beforeGenerate:function(e,t,r){r.children=[e]}},r[t.config.prefix+"show"]=function(e,t,r){e.style.display=t?"":"none"},r[t.config.prefix+"mask"]=function(e,t,r){},t});